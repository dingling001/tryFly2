<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>车集市 · 双11购车节（领克专场）</title>
    <link rel="stylesheet" href="https://cdn.bootcss.com/weui/1.1.3/style/weui.min.css">
    <link rel="stylesheet" href="../assets/css/linke.css">
    <script src="../assets/js/window.js"></script>

</head>
<body ontouchstart>
<div id="app" v-cloak>
    <div class="topimg"><img :src="activeInfo.bannerImg" alt=""></div>
    <div class="bg bg1">
        <div class="bg dcyl_bg">
            <div class="content">
                <div class="active_time">
                    <div class="btn">活动时间</div>
                    <span>{{activeInfo.start_date}}-{{activeInfo.end_date}}</span>
                </div>
                <!--<div class="btn"><span>02</span>活动内容</div>-->
                <ul class="active_content">
                    <li>凡通过车集市平台询价订车，有机会获得<span
                            class="price">{{activeInfo.price|NumFormat}}</span> 元现金礼券，另有丰富大礼赠送。
                    </li>
                    <li>成功购车者，通过车集市上传发票认证后,可有机会获得价值<span class="price">50,000</span> 元购车大礼包；</li>
                </ul>
                <ul class="tips">
                    <li>· 本次活动适用于CS55PLUS、锐程CC车型</li>
                    <li>· 活动最终解释权归北京星系互动科技有限公司所有</li>
                </ul>
            </div>
        </div>
    </div>
    <div class="bg bg2">
        <div class="bg dcyl_bg">
            <div class="content">
                <div class=" title">参与抽奖，赢取丰富大礼</div>
                <div class="active_content1">即日起参与抽奖，有机会赢取购车礼包，万元购车礼金、全新iPhone Pro拿不停，快来试试手气吧</div>
            </div>
            <div class="game">
                <img src="../assets/imgs/lingke/tigger.png" alt="">
                <!--<div class="gamebtn"></div>-->
                <div class="box">
                    <div class="item"></div>
                    <div class="item"></div>
                    <div class="item"></div>
                    <div class="item"></div>
                    <div class="item start" @click="showtips"></div>
                    <div class="item"></div>
                    <div class="item"></div>
                    <div class="item"></div>
                    <div class="item"></div>
                    <div class="spin" id="spin" v-show="start"></div>
                </div>
            </div>
        </div>
    </div>
    <div class="bg bg3">
        <div class="form_tab">
            <span :class="{'active':tabindex==0}" @click="tab(0)">我要订车</span>
            <span :class="{'active':tabindex==1}" @click="tab(1)">成功提车</span>
        </div>
        <form class="form" v-if="tabindex==0">
            <div class="inputbox"><label>姓名</label><input type="text" placeholder="" v-model="name"></div>
            <div class="inputbox"><label>手机号</label><input type="number" placeholder="" v-model="tel"></div>
            <div class="citybox">
                <div class="inputbox arrow ">
                    <label>省</label>
                    <select name="" v-model="pro" @change="prov_change">
                        <option :value="item.name" v-for="(item,index) in city_data">{{item.name}}</option>
                    </select>
                </div>
                <div class="inputbox arrow ">
                    <label>市</label>
                    <select name="" v-model="cit" @change="city_change">
                        <option :value="i.name" v-for="(i,iindex) in citylist">{{i.name}}</option>
                    </select>
                </div>
            </div>
            <!--<div class="inputbox arrow">-->
                <!--<label>车型</label>-->
                <!--<select v-model="cartype_val" @change="car_change">-->
                    <!--<option :value="item.name" v-for="item in cartType">{{item.name}}</option>-->
                <!--</select>-->
                <!--&lt;!&ndash;<input type="text" id="car"/>&ndash;&gt;-->
            <!--</div>-->
            <div class="inputbox"><label>备注</label><input type="text" placeholder="" v-model="remark"/></div>
            <div class="formbtn" @click="orderform">确认提交</div>
        </form>
        <form class="form" v-else>
            <div class="fapiao" v-if="fapiao">
                <img :src="getObjectURL(fapiao)" alt="">
                <input type="file" @change="upimg($event)" ref="inputer"
                       accept="image/png,image/jpeg,image/gif,image/jpg"/>
            </div>
            <div class="fapiao" v-else>
                <div class="plus">+</div>
                <div>上传发票</div>
                <input type="file" @change="upimg($event)" ref="inputer"
                       accept="image/png,image/jpeg,image/gif,image/jpg"/>
            </div>
            <div class="formbtn" @click="uploadFapiao">确认提交</div>
        </form>
        <!--        点击确认提交、上传发票 即视为同意《个人信息保护声明》您的个人资料将会提交至领克厂商的授权经销商或车集市客服与您进一步沟通购车事宜。-->
        <div class="agreement">点击确认提交、上传发票 即视为同意 <a href="./shengming.html">《个人信息保护声明》</a>您的个人资料将会提交至长安厂商的授权经销商或车集市客服
            与您进一步沟通购车事宜。
        </div>
    </div>
    <div class="bottom bg">
        <div class="jmct_title"><img src="../assets/imgs/lingke/title3.png" alt=""></div>
    </div>
    <div class="weui-mask weui-mask--visible" v-if="show_box"></div>
    <div class="weui-dialog weui-dialog--visible" v-if="show_box">
        <div class="weui-dialog__hd"><strong class="weui-dialog__title">{{title}}</strong></div>
        <div class="weui-dialog__bd" v-if="!canPrize"><span class="img"></span>{{tips}}</div>
        <div class="weui-dialog__bd" v-else>
            请将此兑奖码发送至邮箱
            <div><span class="email">{{email}}</span>进行兑奖查询</div>
        </div>
        <div class="weui-dialog__ft"><span class="weui-dialog__btn gameknow" @click="closeMold">我知道了</span></div>
    </div>
    <div class="weui-mask_transparent" v-if="mask"></div>
    <div class="weui-toast weui_loading_toast weui-toast--visible" v-if="loadShow">
        <div class="weui_loading"><i class="weui-loading weui-icon_toast"></i></div>
        <p class="weui-toast_content">{{text||'加载中…'}}</p>
    </div>
</div>
</body>
</html>

<script src="https://cdn.bootcss.com/Swiper/3.3.1/js/swiper.min.js"></script>
<script src="../assets/js/json.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js" type="text/javascript"></script>
<script type="text/javascript">
    Vue.filter('NumFormat', function (value) {
        if (!value) return '0';
        /*原来用的是Number(value).toFixed(0)，这样取整时有问题，例如0.51取整之后为1，感谢Nils指正*/
        var intPart = Number(value) | 0; //获取整数部分
        var intPartFormat = intPart.toString().replace(/(\d)(?=(?:\d{3})+$)/g, '$1,'); //将整数部分逢三一断

        var floatPart = ""; //预定义小数部分
        var value2Array = value.split(".");

        //=2表示数据有小数位
        if (value2Array.length == 2) {
            floatPart = value2Array[1].toString(); //拿到小数部分

            if (floatPart.length == 1) { //补0,实际上用不着
                return intPartFormat + "." + floatPart + '0';
            } else {
                return intPartFormat + "." + floatPart;
            }

        } else {
            return intPartFormat + floatPart;
        }

    });
    var _ = new Vue({
        el: '#app',
        data: {
            activeInfo: {
                bannerImg: '../assets/imgs/lingke/top.png',
                start_date: '1月1日',
                end_date: "1月31日",
                price: '9999',
                cartypedata: [
                    {
                        typename: '吉利',
                        list: [
                            {
                                value: '全新金刚',
                                id: 1,
                                img: '../assets/imgs/caricon.jpg',
                                lubo: ['../assets/imgs/c1.png', '../assets/imgs/c2.jpg', '../assets/imgs/c3.jpg']
                            },
                            {
                                value: '新帝豪三厢',
                                id: 2,
                                img: '../assets/imgs/caricon1.jpeg',
                                lubo: ['../assets/imgs/c2.jpg', '../assets/imgs/c3.jpg', '../assets/imgs/c1.png']
                            },
                            {
                                value: '全球鹰',
                                id: 3,
                                img: '../assets/imgs/caricon2.jpeg',
                                lubo: ['../assets/imgs/c3.jpg', '../assets/imgs/c2.jpg', '../assets/imgs/c3.jpg']
                            },
                            {
                                value: '新远景',
                                id: 4,
                                img: '../assets/imgs/caricon.jpg',
                                lubo: ['../assets/imgs/c1.png', '../assets/imgs/c2.jpg', '../assets/imgs/c3.jpg']
                            },
                            {
                                value: '博越PRO',
                                id: 5,
                                img: '../assets/imgs/caricon2.jpeg',
                                lubo: ['../assets/imgs/c2.jpg', '../assets/imgs/c2.jpg', '../assets/imgs/c3.jpg']
                            },
                        ],
                    },
                    {
                        typename: '领克',
                        list: [
                            {
                                value: '全新金刚',
                                id: 1,
                                img: '../assets/imgs/caricon.jpg',
                                lubo: ['../assets/imgs/c1.png', '../assets/imgs/c2.jpg', '../assets/imgs/c3.jpg']
                            },
                            {
                                value: '新帝豪三厢',
                                id: 2,
                                img: '../assets/imgs/caricon1.jpeg',
                                lubo: ['../assets/imgs/c2.jpg', '../assets/imgs/c3.jpg', '../assets/imgs/c1.png']
                            },
                            {
                                value: '全球鹰',
                                id: 3,
                                img: '../assets/imgs/caricon2.jpeg',
                                lubo: ['../assets/imgs/c3.jpg', '../assets/imgs/c2.jpg', '../assets/imgs/c3.jpg']
                            },
                            {
                                value: '新远景',
                                id: 4,
                                img: '../assets/imgs/caricon.jpg',
                                lubo: ['../assets/imgs/c1.png', '../assets/imgs/c2.jpg', '../assets/imgs/c3.jpg']
                            },
                            {
                                value: '博越PRO',
                                id: 5,
                                img: '../assets/imgs/caricon2.jpeg',
                                lubo: ['../assets/imgs/c2.jpg', '../assets/imgs/c2.jpg', '../assets/imgs/c3.jpg']
                            },
                        ],
                    }
                ],
            },
            cartType: [{name: '全新金刚', id: 1}, {name: '新帝豪三厢', id: 2}, {name: '全球鹰', id: 3}, {
                name: '新远景',
                id: 4
            }, {name: '博越PRO', id: 5}],
            cartype_id: '',
            cartype_val: '',
            name: '',
            tel: '',
            pro: '',
            cit: '',
            remark: '',
            citylist: [],
            cartype: '',
            tabindex: 0,
            city_data: cityData,
            sindex: 0,
            swiperitem: {
                lubo: []
            },
            fapiao: '',
            mySwiper: null,
            show_box: false,//抽奖弹窗
            canPrize: false,
            title: '温馨提示',//抽奖头部内容
            tips: '',// 抽奖提示内容
            email: 'info@singsdigital.cn',//中奖发的邮箱
            loadShow: false,
            mask: false,
            text: '加载中...',
            start: false
        },
        created() {
            this.$nextTick(() => {
                // console.log(this.cartypedata)
                // console.log(this.city_data)
                // console.log(this.cartypedata)
                this.swiperitem = this.activeInfo.cartypedata[this.sindex].list[0];
                // console.log(this.pro)
                // console.log(this.cartype_val);
                // console.log(this.cartype_val)
                var provce = '陕西',//默认省 为空默认第一个
                    city = '延安',//默认市 为空默认第一个
                    cartype_val = '新远景',//默认车型 为空默认第一个
                    canPrize = false, //true可抽奖。false不可抽奖  //默认可抽奖状态为false，渲染后返回值赋值
                    email = 'info@singsdigital.cn',//默认邮箱
                    title = '温馨提示';//中奖码 默认为温馨提示

                for (var i in this.city_data) {
                    for (var j in  this.city_data[i].sub) {
                        if (provce == this.city_data[i].name) {
                            if (city == this.city_data[i].sub[j].name) {
                                // this.pro = provce;
                                // this.cit = city;
                                this.citylist = this.city_data[i].sub
                            }
                        } else if (provce == '' && city == '') {
                            // this.pro = this.city_data[0].name;
                            this.citylist = this.city_data[0].sub;
                            // this.cit = this.city_data[0].sub[0].name;
                        }
                    }
                }
                this.pro = provce;
                this.cit = city;
                this.cartype_val = cartype_val;
                this.canPrize = canPrize;
                this.email = email;
                this.title = title;
            });
        },

        watch: {
            // 监听轮播图变化
            'swiperitem': {
                handler(val) {
                    this.mySwiper = new Swiper('.swiper-container', {
                        pagination: '.swiper-pagination',
                        observer: true, // 监听动态加载 dom 结构
                        observeParents: true,
                        observeSlideChildren: true,
                    });
                },
                deep: true
            }
        },
        methods: {
            // 订车，提车
            tab(index) {
                this.tabindex = index;
            },
            // 省变化事件
            prov_change(val) {
                console.log(this.pro)
                for (var i in this.city_data) {
                    if (this.pro == this.city_data[i].name) {
                        this.citylist = this.city_data[i].sub;
                    }
                }
                this.cit = this.citylist[0].name
            },
            // 市变化事件
            city_change() {
                // console.log(this.cit)
            },
            // 车型变化事件
            car_change() {
                // this.cartype_id = this.cartype_val.id;
                for (let k in this.cartType) {
                    if (this.cartype_val == this.cartType[k].name) {
                        this.cartype_id = this.cartType[k].id
                    }
                }
                console.log(this.cartype_id)
            },
            // 确认提交
            orderform() {
                var telReg = /^1\d{10}$/gi;
                if (this.name == '') {
                    this.Toast('请输入姓名')
                } else if (!telReg.test(this.tel)) {
                    this.Toast('手机号不正确')
                } else if (this.pro == '') {
                    this.Toast('请选择省份')
                } else if (this.cit == '') {
                    this.Toast('请选择城市')
                }
                // else if (this.cartype_id == '') {
                //     this.Toast('请选择车型')
                // }
                else {
                    // TODO
                }

            },
            // 切换车类
            changeImg(index) {
                this.sindex = index;
                this.swiperitem = this.activeInfo.cartypedata[this.sindex].list[index]
            },
            // 切换轮播图
            changeswiper() {
                // console.log(this.swiperitem.lubo)
            },
            // 监听图片上传
            upimg(e) {
                let inputDOM = this.$refs.inputer;
                // 通过DOM取文件数据
                this.fil = inputDOM.files;
                console.log(this.fil)
                this.fapiao = this.fil[0];
                console.log(this.fapiao)
            },
            // 确认上传
            uploadFapiao() {
                console.log(this.fapiao)
            },
            // 获取本地路径
            getObjectURL(file) {
                console.log(file)
                var getUrl = null;
                if (window.createObjectURL != undefined) { // basic
                    getUrl = window.createObjectURL(file);
                } else if (window.URL != undefined) { // mozilla(firefox)
                    getUrl = window.URL.createObjectURL(file);
                } else if (window.webkitURL != undefined) { // webkit or chrome
                    getUrl = window.webkitURL.createObjectURL(file);
                }
                return getUrl;
            },
            // 抽奖
            showtips() {
                var that = this;
                var rr = [2, 6];
                var r = this.randomNum(0, 1);
                // that.start = true;
                // that.run(document.getElementById('spin'), that.generateCirclePath(3, 109.83), 3, 60, 0, that.generateCirclePath(3, 109.83).length, rr[r])
                if (that.canPrize) {
                    that.start = true;
                    that.run(document.getElementById('spin'), that.generateCirclePath(3, 109.83), 3, 60, 0, that.generateCirclePath(3, 109.83).length, rr[r])
                } else {
                    that.show_box = true;
                    that.tips = '此处仅针对通过车集市参与本次活动订车的车主未通过本活动订车的购车主无法参加'
                }
            },
            // 关闭窗口
            closeMold() {
                this.show_box = false;
                //  TODO
            },
            // ios底部select失去焦点导致页面被顶起，
            selectBlurF() {
                //做100毫秒的延迟处理保证 scrollHeight的值是准确的
                setTimeout(function () {
                    //  失去焦点后  //设置滚动条到最底部
                    document.body.scrollTop = document.documentElement.scrollTop = document.body.scrollHeight
                    // console.log(document.body.scrollHeight)
                }, 100);
            },
            // 弹窗
            Toast(msg, duration) {
                duration = isNaN(duration) ? 3000 : duration;
                var m = document.createElement('div');
                m.innerHTML = msg;
                m.style.cssText = "max-width:60%;min-width: 150px;padding:0 14px;height: 40px;color: rgb(255, 255, 255);line-height: 40px;text-align: center;border-radius: 4px;position: fixed;top: 50%;left: 50%;transform: translate(-50%, -50%);z-index: 999999;background: rgba(0, 0, 0,.7);font-size: 16px;";
                document.body.appendChild(m);
                setTimeout(function () {
                    var d = 0.5;
                    m.style.webkitTransition = '-webkit-transform ' + d + 's ease-in, opacity ' + d + 's ease-in';
                    m.style.opacity = '0';
                    setTimeout(function () {
                        document.body.removeChild(m)
                    }, d * 1000);
                }, duration);
            },
            //展示loading效果
            showLoading(mask, text) {
                // 参数说明
                // mask:出现loading 是否可以进行其他操作 默认值 fasle
                // text:loading图标下的字样 默认加载中……
                // 其他 超过10s自动关闭laoding
                this.mask = mask;
                this.text = text;
                this.loadShow = true;
                var t = setTimeout(() => {
                    this.mask = false;
                    this.loadShow = false;
                    clearTimeout(t)
                }, 10000)
            },
            //移除loading效果
            completeLoading() {
                this.mask = false;
                this.loadShow = false;
            },
            // 新增

            /**
             * 生成n维环形坐标
             * @param {number} n 维度
             * @param {number} cell 单位坐标长度
             */
            generateCirclePath(n, cell) {
                let arr = []
                for (let i = 0; i < n; i++) {
                    arr.push([i * cell, 0])
                }
                for (let i = 0; i < n - 1; i++) {
                    arr.push([(n - 1) * cell, (i + 1) * cell])
                }
                for (let i = 0; i < n - 1; i++) {
                    arr.push([(n - i - 2) * cell, (n - 1) * cell])
                }
                for (let i = 0; i < n - 2; i++) {
                    arr.push([0, (n - i - 2) * cell])
                }
                console.log(arr)
                return arr
            },
            /**
             * 环形随机轨道运动函数
             * @param {element} el 运动的dom元素
             * @param {array} path 运动的环形坐标集合
             * @param {number} speed 运动的初始速度
             * @param {number} i 运动的初始位置
             * @param {number} len 路径的长度
             * @param {number} random 中奖坐标
             */
            // min + Math.floor(Math.random() * (max - min + 1));
            run(el, path, n = 1, speed = 60, i = 0, len = path.length, random = Math.floor(Math.random() * len)) {
                var that = this;
                setTimeout(() => {
                    if (n > 0) {
                        // 如果n为1,则设置中奖数值
                        if (n === 1) {
                            len = random
                            setTimeout(function () {
                                that.show_box = true;
                            },speed*len)
                        }
                        if (len <= i) {
                            i = n === 1 ? len : 0;
                            n--;
                            speed += (300 - speed) / n
                        }
                        el.style.transform = `translate(${path[i][0]}px, ${path[i][1]}px)`
                        this.run(el, path, n, speed, ++i, len, random)
                    }
                }, speed)
            },
            // 随机数
            randomNum(minNum, maxNum, decimalNum) {
                var x = 0;
                var max = 0, min = 0;
                minNum <= maxNum ? (min = minNum, max = maxNum) : (min = maxNum, max = minNum);
                switch (arguments.length) {
                    case 1:
                        x = Math.floor(Math.random() * (max + 1));
                        break;
                    case 2:
                        x = Math.floor(Math.random() * (max - min + 1) + min);
                        break;
                    case 3:
                        x = (Math.random() * (max - min) + min).toFixed(decimalNum);
                        break;
                    default:
                        x = Math.random();
                        break;
                }
                return x
            },
            // 防抖函数,避免频繁点击执行多次函数
            debounce(fn, t = 300, immediate = true) {
                if (typeof fn !== 'function') throw new Error('第一个参数必须是方法')
                let _fn = fn;
                let timer;
                return function () {
                    if (timer) clearTimeout(timer);
                    if (immediate) {
                        // 如果已经执行过，不再执行
                        var callNow = !timer;
                        timer = setTimeout(() => {
                            timer = null;
                        }, t)
                        if (callNow) {
                            _fn.apply(this, arguments)
                        }
                    } else {
                        timer = setTimeout(() => {
                            _fn.apply(this, arguments)
                        }, t);
                    }
                }
            }
        }
    })
</script>